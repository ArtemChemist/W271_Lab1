---
title: "Lab 1, Short Questions"
geometry: margin=1in
output:
  pdf_document:
    toc: yes
    number_sections: yes
fontsize: 11pt
---

```{r load packages for homework 2, message=FALSE}
library(tidyverse)
library(patchwork)
library(GGally)
library(nnet)
library(car)
```

# Strategic Placement of Products in Grocery Stores (5 points)

These questions are taken from Question 12 of chapter 3 of the textbook(Bilder and Loughin’s “Analysis of Categorical Data with R.

> *In order to maximize sales, items within grocery stores are strategically placed to draw customer attention. This exercise examines one type of item—breakfast cereal. Typically, in large grocery stores, boxes of cereal are placed on sets of shelves located on one side of the aisle. By placing particular boxes of cereals on specific shelves, grocery stores may better attract customers to them. To investigate this further, a random sample of size 10 was taken from each of four shelves at a Dillons grocery store in Manhattan, KS. These data are given in the *cereal_dillons.csv *file. The response variable is the shelf number, which is numbered from bottom (1) to top (4), and the explanatory variables are the sugar, fat, and sodium content of the cereals.*

```{r read cereal data, message=FALSE}
cereal <- read_csv('../data/short-questions/cereal_dillons.csv')
cereal
```


## Recode Data 
(1 point) The explanatory variables need to be reformatted before proceeding further (sample code is provided in the textbook). First, divide each explanatory variable by its serving size to account for the different serving sizes among the cereals. Second, rescale each variable to be within 0 and 1. Construct side-by-side box plots with dot plots overlaid for each of the explanatory variables. Also, construct a parallel coordinates plot for the explanatory variables and the shelf number. Discuss whether possible content differences exist among the shelves.

```{r recode data}
stand01 <- function(x){
  (x - min(x))/(max(x) - min(x))
}
cereal2 <- data.frame(
  Shelf = cereal$Shelf,
  Cereal = cereal$Cereal,
  sugar = stand01(x = cereal$sugar_g/cereal$size_g),
  fat = stand01(x = cereal$fat_g/cereal$size_g),
  sodium = stand01(x = cereal$sodium_mg/cereal$size_g)
)
```

```{r boxplots}
# Sugar
boxplot(formula = sugar ~ Shelf, data = cereal2, ylab = "Sugar", xlab = "Shelf", pars = list(outpch = NA))
stripchart(x = cereal2$sugar ~ cereal2$Shelf, lwd = 2, col = "red", method = "jitter", vertical = TRUE, pch = 1, add = TRUE)

# Fat
boxplot(formula = fat ~ Shelf, data = cereal2, ylab = "Fat", xlab = "Shelf", pars = list(outpch = NA))
stripchart(x = cereal2$fat ~ cereal2$Shelf, lwd = 2, col = "red", method = "jitter", vertical = TRUE, pch = 1, add = TRUE)

# Sodium
boxplot(formula = sodium ~ Shelf, data = cereal2, ylab = "Sodium", xlab = "Shelf", pars = list(outpch = NA))
stripchart(x = cereal2$sodium ~ cereal2$Shelf, lwd = 2, col = "red", method = "jitter", vertical = TRUE, pch = 1, add = TRUE)
```

> It appears that the items that are higher in sodium tend to be on shelf #1. Items that are high in sugar tend to go on shelf #2. For fat, there does not appear to be any obvious trends of which shelf items that are high or low in fat go to.

```{r parallel coordinates plot}
cereal2$ShelfNumber <- as.character(cereal2$Shelf)
ggparcoord(data = cereal2, columns = 3:5, groupColumn = "ShelfNumber", showPoints = TRUE, scale = "uniminmax")
```

> The parallel coordinates plot is harder to glean information from than the box plots. When looking closely one can find much of the same information that was found in the box plots. Namely, the highest sugar items belonging to shelf #2 and the high sodium items being found in shelf #1.

> Without running an regression it is not responsible to say definitively whether or not a content different exists between the shelves. Based on these graphs there doesn't seem to be too big of a relationship between sugar, fat, and sodium and the shelf a cereal belongs to.

## Evaluate Ordinal vs. Categorical 
(1 point) The response has values of $1, 2, 3,$ and $4$. Explain under what setting would it be desirable to take into account ordinality, and whether you think that this setting occurs here. Then estimate a suitable multinomial regression model with linear forms of the sugar, fat, and sodium variables. Perform LRTs to examine the importance of each explanatory variable. Show that there are no significant interactions among the explanatory variables (including an interaction among all three variables).

> Ordinal data would make sense in the case where there's a natural ordering to the shelves. Such as if higher shelves were inherently more desirable than lower shelves. Then it would be expected that better selling products be placed on higher shelves. It doesn't appear as if this is the case here as the most desirable shelves would likely be at eye level (towards the middle) and there doesn't appear to be any other sort of ordering at play.

```{r multinomial logit regressions}
model_cereal_shelves_linear    <- multinom(formula = factor(Shelf) ~ sugar + fat + sodium, data = cereal2, family = "multinomial")
model_cereal_shelves_quadratic <- multinom(formula = factor(Shelf) ~ sugar*fat*sodium, data = cereal2, family = "multinomial")
model_cereal_shelves_linear
model_cereal_shelves_quadratic
```

```{r likelihood ratio tests: main effects}
lrt_cereal_main_effects <- Anova(model_cereal_shelves_linear, test = "LR")
lrt_cereal_main_effects
```

```{r likelihood ratio tests: interaction effects} 
lrt_cereal_quadratic_effects <- Anova(model_cereal_shelves_quadratic, test = "LR")
lrt_cereal_quadratic_effects
```

> Similar to what the graphs show there is clearly an obvious relationship between sugar, sodium, and shelf placement. The Anova test shows that none of the interaction terms are significant as well as the linear fat variable.

## Where do you think Apple Jacks will be placed? 
(1 point) Kellogg’s Apple Jacks (http://www.applejacks.com) is a cereal marketed toward children. For a serving size of $28$ grams, its sugar content is $12$ grams, fat content is $0.5$ grams, and sodium content is $130$ milligrams. Estimate the shelf probabilities for Apple Jacks.

```{r predictions for apple jacks}
stand02 <- function(x, min, max){
  (x - min)/(max - min)
}
cereal3 <- data.frame(
  sugar = stand02(12/28, 0, 15/27),
  fat = stand02(0.5/28, 0, 5/54),
  sodium = stand02(130/28, 0, 300/28)
)

pi.hat.1 <- predict(object = model_cereal_shelves_linear, newdata = cereal3, type = "probs")

aj_shelf_probs <- round(head(pi.hat.1), 4)
aj_shelf_probs
```

> The model predicts that Apple Jacks be placed on shelf #3.

## Figure 3.3 
(1 point) Construct a plot similar to Figure 3.3 where the estimated probability for a shelf is on the *y-axis* and the sugar content is on the *x-axis*. Use the mean overall fat and sodium content as the corresponding variable values in the model. Interpret the plot with respect to sugar content.

```{r create figure 3.3}
sugar <- seq(0, 1, by=0.01)
mean_fat <- replicate(101, mean(stand01(cereal2$fat)))
mean_sodium <- replicate(101, mean(stand01(cereal2$sodium)))
cereal4 <- data.frame(
  sugar = sugar,
  fat = mean_fat,
  sodium = mean_sodium
)
pi.hat.2 <- predict(object = model_cereal_shelves_linear, newdata = cereal4, type = "probs")

plot.data <- data.frame(prediction = pi.hat.2, observed = seq(0, 1, by=0.01))
shelf_vs_sugar_plot <- ggplot(plot.data, aes(x = observed)) + 
  geom_line(aes(y = prediction.1)) +
  geom_line(aes(y = prediction.2), linetype = "dashed") +
  geom_line(aes(y = prediction.3), linetype = "dotted") +
  geom_line(aes(y = prediction.4), linetype = "twodash") +
  labs(title = "Predicted Probabilities of Shelf", y = "Probability", x = "Sugar")

shelf_vs_sugar_plot
```

> As sugar increases the likelihood of being on shelf 1 or shelf 2 increases. When sugar is low the cereal is most likely to be placed on shelf 3 or 4.

## Odds ratios 
(1 point) Estimate odds ratios and calculate corresponding confidence intervals for each explanatory variable. Relate your interpretations back to the plots constructed for this exercise. 

```{r produce odds ratios}
coefs.2 <- coef(model_cereal_shelves_linear)[1,]
se.2 <- round(summary(model_cereal_shelves_linear)$standard.errors[1,], 2)
ci.2 <- round(data.frame(estimate = exp(coefs.2), lower = exp(coefs.2 - 1.96*se.2), upper =  exp(coefs.2 + 1.96*se.2)), 2)
ci.2

coefs.3 <- coef(model_cereal_shelves_linear)[2,]
se.3 <- round(summary(model_cereal_shelves_linear)$standard.errors[2,], 2)
ci.3 <- round(data.frame(estimate = exp(coefs.3), lower = exp(coefs.3 - 1.96*se.3), upper =  exp(coefs.3 + 1.96*se.3)), 2)
ci.3

coefs.4 <- coef(model_cereal_shelves_linear)[3,]
se.4 <- round(summary(model_cereal_shelves_linear)$standard.errors[3,], 2)
ci.4 <- round(data.frame(estimate = exp(coefs.4), lower = exp(coefs.4 - 1.96*se.4), upper =  exp(coefs.4 + 1.96*se.4)), 2)
ci.4

odds_ratios <- c(ci.2, ci.3, ci.4)
```

> One can see that the estimate and corresponding interval for shelf 2's parameters indicate that the odds increase substantially as `fat` and `sugar` increase. It is also seen that the odds increase very slowly for shelves 2-4 as `sodium` increases showing that shelf 1 is the most probable shelf when sodium is high. Lastly, the confidence intervals are fairly wide which is a result of the weak correlation between the variables and shelf number as well as the limited number of samples.


# Alcohol, self-esteem and negative relationship interactions (5 points)

Read the example **'Alcohol Consumption'** in chapter 4.2.2 of the textbook(Bilder and Loughin’s “Analysis of Categorical Data with R). This is based on a study in which moderate-to-heavy drinkers (defined as at least 12 alcoholic drinks/week for women, 15 for men) were recruited to keep a daily record of each drink that they consumed over a 30-day study period. Participants also completed a variety of rating scales covering daily events in their lives and items related to self-esteem. The data are given in the *DeHartSimplified.csv *data set. Questions 24-26 of chapter 3 of the textbook also relate to this data set and give definitions of its variables: the number of drinks consumed (`numall`), positive romantic-relationship events (`prel`), negative romantic-relationship events (`nrel`), age (`age`), trait (long-term) self-esteem (`rosn`), state (short-term) self-esteem (`state`).

The researchers stated the following hypothesis:

> *We hypothesized that negative interactions with romantic partners would be associated with alcohol consumption (and an increased desire to drink). We predicted that people with low trait self-esteem would drink more on days they experienced more negative relationship interactions compared with days during which they experienced fewer negative relationship interactions. The relation between drinking and negative relationship interactions should not be evident for individuals with high trait self-esteem.*

```{r read drinking data, message=FALSE}
drinks <- read_csv('../data/short-questions/DeHartSimplified.csv')
```

## EDA 
(2 points) Conduct a thorough EDA of the data set, giving special attention to the relationships relevant to the researchers' hypotheses. Address the reasons for limiting the study to observations from only one day.

```{r drinking EDA}

```

> 'Fill this in: What do you learn?' 

## Hypothesis One 
(2 points) The researchers hypothesize that negative interactions with romantic partners would be associated with alcohol consumption and an increased desire to drink. Using appropriate models, evaluate the evidence that negative relationship interactions are associated with higher alcohol consumption and an increased desire to drink. 

> 'Fill this in: What do you learn?' 

## Hypothesis Two
(1 point) The researchers hypothesize that the relation between drinking and negative relationship interactions should not be evident for individuals with high trait self-esteem. Conduct an analysis to address this hypothesis.

> 'Fill this in: What do you learn?' 